# Database Migrations

This directory contains SQL migration files generated by Drizzle Kit.

## Overview

Migrations are automatically generated from schema definitions in `database/schema/` and represent incremental changes to the database structure.

## Migration Files

Each migration consists of two files:
- `{timestamp}_{description}.sql` - The actual SQL migration
- `meta/_journal.json` - Migration metadata and history

## Applying Migrations

### Development
```bash
# From backend directory
cd backend
npm run db:migrate
```

### Production
Migrations are automatically applied during deployment via Vercel build process.

## Migration Workflow

1. **Modify Schema**: Edit files in `database/schema/`
2. **Generate Migration**: Run `npm run db:generate` from backend directory
3. **Review SQL**: Check generated SQL in this directory
4. **Test Locally**: Apply with `npm run db:migrate`
5. **Commit**: Add migration files to git
6. **Deploy**: Migrations run automatically on deployment

## Important Notes

- ⚠️ **Never edit migration files manually** - regenerate if changes needed
- ⚠️ **Always review generated SQL** before applying to production
- ⚠️ **Test migrations locally** before committing
- ⚠️ **Backup data** before running migrations on important databases

## Rollback

Drizzle Kit does not provide automatic rollback. To rollback:
1. Restore database from backup
2. Remove problematic migration from `_journal.json`
3. Regenerate migrations from corrected schema

## Meta Directory

The `meta/` subdirectory contains:
- `_journal.json` - Migration history and ordering
- `{timestamp}_snapshot.json` - Schema snapshot at migration time

This metadata ensures migrations are applied in correct order and tracks schema evolution.
