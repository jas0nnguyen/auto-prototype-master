openapi: 3.0.3
info:
  title: Quote API - Tech Startup Flow Extensions
  description: Extensions to existing Quote API for tech-startup flow specific features
  version: 2.0.0
  contact:
    name: Auto Insurance Prototype
    email: support@example.com

servers:
  - url: http://localhost:3000/api/v1
    description: Local development

paths:
  /communications:
    post:
      summary: Store communication contact information
      description: Save email and/or mobile phone for a quote (Screen 3 - Email Collection)
      operationId: createCommunication
      tags:
        - Communications
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommunicationRequest'
            examples:
              emailAndPhone:
                summary: Email and mobile phone
                value:
                  quote_id: "a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"
                  party_id: "b1ffce99-9c0b-4ef8-bb6d-6bb9bd380a22"
                  communications:
                    - type: "EMAIL"
                      value: "john.doe@example.com"
                    - type: "MOBILE"
                      value: "+14155551234"
      responses:
        '201':
          description: Communication created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunicationResponse'
        '400':
          description: Invalid communication data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /user-accounts/check-email:
    post:
      summary: Check if email exists in user accounts
      description: Determine if user needs to create account or login (Screen 11 - Checkout)
      operationId: checkEmailExists
      tags:
        - User Accounts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: "john.doe@example.com"
      responses:
        '200':
          description: Email existence check result
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  data:
                    type: object
                    properties:
                      exists:
                        type: boolean
                        description: Whether the email is already registered
                        example: false
                      user_id:
                        type: string
                        format: uuid
                        nullable: true
                        description: User ID if email exists
                        example: null
              examples:
                newUser:
                  summary: Email not found (new user)
                  value:
                    status: "success"
                    data:
                      exists: false
                      user_id: null
                existingUser:
                  summary: Email found (existing user)
                  value:
                    status: "success"
                    data:
                      exists: true
                      user_id: "c2ffce99-9c0b-4ef8-bb6d-6bb9bd380a33"

  /user-accounts:
    post:
      summary: Create new user account
      description: Register new user during checkout (Screen 11 - New Account Setup Modal)
      operationId: createUserAccount
      tags:
        - User Accounts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserAccountRequest'
            examples:
              newAccount:
                summary: Create new account
                value:
                  email: "john.doe@example.com"
                  password: "SecurePassword123!"
                  first_name: "John"
                  last_name: "Doe"
      responses:
        '201':
          description: User account created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserAccountResponse'
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                duplicate:
                  value:
                    status: "error"
                    error:
                      code: "DUPLICATE"
                      message: "Email address already registered"

components:
  schemas:
    CreateCommunicationRequest:
      type: object
      required:
        - quote_id
        - party_id
        - communications
      properties:
        quote_id:
          type: string
          format: uuid
          description: UUID of the quote
        party_id:
          type: string
          format: uuid
          description: UUID of the party
        communications:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - type
              - value
            properties:
              type:
                type: string
                enum: [EMAIL, MOBILE]
                description: Type of communication
              value:
                type: string
                description: Email address or phone number
                example: "john.doe@example.com"

    CommunicationResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        data:
          type: object
          properties:
            communications:
              type: array
              items:
                type: object
                properties:
                  communication_id:
                    type: string
                    format: uuid
                  type:
                    type: string
                    enum: [EMAIL, MOBILE]
                  value:
                    type: string
                  created_at:
                    type: string
                    format: date-time

    CreateUserAccountRequest:
      type: object
      required:
        - email
        - password
        - first_name
        - last_name
      properties:
        email:
          type: string
          format: email
          description: User's email address (must be unique)
        password:
          type: string
          format: password
          minLength: 8
          description: User's password (minimum 8 characters)
        first_name:
          type: string
          description: User's first name
        last_name:
          type: string
          description: User's last name

    UserAccountResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        data:
          type: object
          properties:
            user_account_id:
              type: string
              format: uuid
            email:
              type: string
              format: email
            first_name:
              type: string
            last_name:
              type: string
            created_at:
              type: string
              format: date-time

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          enum: [error]
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: array
              items:
                type: object
