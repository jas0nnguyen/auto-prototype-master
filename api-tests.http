###
# Auto Insurance Quote Flow - API Test Collection
#
# Use with VS Code REST Client extension or similar tools
# https://marketplace.visualstudio.com/items?itemName=humao.rest-client
###

@baseUrl = http://localhost:3000/api/v1
@contentType = application/json

###############################################################################
# 1. MOCK SERVICES
###############################################################################

### 1.1 Test VIN Decoder (Honda Accord)
POST {{baseUrl}}/mock/vin-decoder
Content-Type: {{contentType}}

{
  "vin": "1HGBH41JXMN109186"
}

### 1.2 Test VIN Decoder (Toyota Camry)
POST {{baseUrl}}/mock/vin-decoder
Content-Type: {{contentType}}

{
  "vin": "4T1BF1FK5HU123456"
}

### 1.3 Test Vehicle Valuation
POST {{baseUrl}}/mock/vehicle-valuation
Content-Type: {{contentType}}

{
  "year": 2020,
  "make": "Honda",
  "model": "Accord",
  "mileage": 35000,
  "condition": "GOOD"
}

### 1.4 Test Safety Ratings
POST {{baseUrl}}/mock/safety-ratings
Content-Type: {{contentType}}

{
  "year": 2020,
  "make": "Honda",
  "model": "Accord"
}

###############################################################################
# 2. RATING ENGINE
###############################################################################

### 2.1 Calculate Premium (Good Driver, Normal Car)
POST {{baseUrl}}/rating/calculate
Content-Type: {{contentType}}

{
  "vehicle": {
    "year": 2020,
    "make": "Toyota",
    "model": "Camry",
    "vin": "4T1BF1FK5HU123456",
    "annualMileage": 12000,
    "primaryUse": "COMMUTE"
  },
  "driver": {
    "age": 30,
    "yearsLicensed": 12,
    "violations": [],
    "accidents": [],
    "gender": "M"
  },
  "location": {
    "zipCode": "90210",
    "stateCode": "CA",
    "city": "Beverly Hills"
  },
  "coverages": [
    {
      "coverageCode": "BODILY_INJURY",
      "limits": {
        "perPerson": 100000,
        "perAccident": 300000
      },
      "isSelected": true
    },
    {
      "coverageCode": "PROPERTY_DAMAGE",
      "limits": {
        "perOccurrence": 100000
      },
      "isSelected": true
    },
    {
      "coverageCode": "COLLISION",
      "deductible": 500,
      "isSelected": true
    },
    {
      "coverageCode": "COMPREHENSIVE",
      "deductible": 500,
      "isSelected": true
    }
  ]
}

### 2.2 Calculate Premium (Young Driver, Sports Car)
POST {{baseUrl}}/rating/calculate
Content-Type: {{contentType}}

{
  "vehicle": {
    "year": 2022,
    "make": "BMW",
    "model": "M3",
    "vin": "WBS8M9C55NCE12345",
    "annualMileage": 15000,
    "primaryUse": "PLEASURE"
  },
  "driver": {
    "age": 18,
    "yearsLicensed": 1,
    "violations": [
      {
        "type": "SPEEDING",
        "date": "2024-06-01",
        "severity": "MODERATE"
      }
    ],
    "accidents": [],
    "gender": "M"
  },
  "location": {
    "zipCode": "10001",
    "stateCode": "NY",
    "city": "New York"
  },
  "coverages": [
    {
      "coverageCode": "BODILY_INJURY",
      "limits": {
        "perPerson": 250000,
        "perAccident": 500000
      },
      "isSelected": true
    },
    {
      "coverageCode": "COLLISION",
      "deductible": 1000,
      "isSelected": true
    }
  ]
}

###############################################################################
# 3. QUOTE MANAGEMENT
###############################################################################

### 3.1 Create New Quote (Full Flow)
POST {{baseUrl}}/quotes
Content-Type: {{contentType}}

{
  "vehicle": {
    "vin": "1HGBH41JXMN109186",
    "annualMileage": 12000,
    "primaryUse": "COMMUTE",
    "ownershipType": "OWNED"
  },
  "driver": {
    "firstName": "Jane",
    "lastName": "Smith",
    "birthDate": "1990-05-15",
    "email": "jane.smith@example.com",
    "phone": "555-0100",
    "licenseNumber": "D1234567",
    "licenseState": "CA",
    "yearsLicensed": 12
  },
  "location": {
    "street": "123 Main St",
    "city": "Los Angeles",
    "state": "CA",
    "zipCode": "90001"
  },
  "coverages": [
    {
      "coverageCode": "BODILY_INJURY",
      "limits": {
        "perPerson": 100000,
        "perAccident": 300000
      },
      "isSelected": true
    },
    {
      "coverageCode": "PROPERTY_DAMAGE",
      "limits": {
        "perOccurrence": 100000
      },
      "isSelected": true
    },
    {
      "coverageCode": "COLLISION",
      "deductible": 1000,
      "isSelected": true
    }
  ],
  "effectiveDate": "2025-11-01"
}

### 3.2 Get Quote by ID
# Replace {quoteId} with actual ID from create response
GET {{baseUrl}}/quotes/{quoteId}

### 3.3 Get Quote by Reference Number
# Replace {quoteNumber} with actual number like Q-20251019-AB12CD
GET {{baseUrl}}/quotes/reference/{quoteNumber}

### 3.4 Update Quote Coverage
# Replace {quoteId} with actual ID
PUT {{baseUrl}}/quotes/{quoteId}/coverage
Content-Type: {{contentType}}

{
  "coverages": [
    {
      "coverageCode": "BODILY_INJURY",
      "limits": {
        "perPerson": 250000,
        "perAccident": 500000
      },
      "isSelected": true
    },
    {
      "coverageCode": "PROPERTY_DAMAGE",
      "limits": {
        "perOccurrence": 100000
      },
      "isSelected": true
    },
    {
      "coverageCode": "COLLISION",
      "deductible": 500,
      "isSelected": true
    },
    {
      "coverageCode": "COMPREHENSIVE",
      "deductible": 500,
      "isSelected": true
    },
    {
      "coverageCode": "UNINSURED_MOTORIST",
      "limits": {
        "perPerson": 100000,
        "perAccident": 300000
      },
      "isSelected": true
    }
  ]
}

### 3.5 Recalculate Quote Premium
# Replace {quoteId} with actual ID
POST {{baseUrl}}/quotes/{quoteId}/calculate

###############################################################################
# 4. TEST SCENARIOS
###############################################################################

### 4.1 Scenario: Minimum Coverage (Low Premium)
POST {{baseUrl}}/quotes
Content-Type: {{contentType}}

{
  "vehicle": {
    "vin": "4T1BF1FK5HU123456",
    "annualMileage": 5000,
    "primaryUse": "PLEASURE",
    "ownershipType": "OWNED"
  },
  "driver": {
    "firstName": "Bob",
    "lastName": "Johnson",
    "birthDate": "1975-03-20",
    "email": "bob.j@example.com",
    "phone": "555-0200",
    "licenseNumber": "D9876543",
    "licenseState": "CA",
    "yearsLicensed": 25
  },
  "location": {
    "street": "456 Oak Ave",
    "city": "Fresno",
    "state": "CA",
    "zipCode": "93650"
  },
  "coverages": [
    {
      "coverageCode": "BODILY_INJURY",
      "limits": {
        "perPerson": 15000,
        "perAccident": 30000
      },
      "isSelected": true
    },
    {
      "coverageCode": "PROPERTY_DAMAGE",
      "limits": {
        "perOccurrence": 5000
      },
      "isSelected": true
    }
  ],
  "effectiveDate": "2025-11-01"
}

### 4.2 Scenario: Maximum Coverage (High Premium)
POST {{baseUrl}}/quotes
Content-Type: {{contentType}}

{
  "vehicle": {
    "vin": "WBS8M9C55NCE12345",
    "annualMileage": 20000,
    "primaryUse": "COMMUTE",
    "ownershipType": "LEASED"
  },
  "driver": {
    "firstName": "Alex",
    "lastName": "Martinez",
    "birthDate": "2005-08-10",
    "email": "alex.m@example.com",
    "phone": "555-0300",
    "licenseNumber": "D1111111",
    "licenseState": "CA",
    "yearsLicensed": 2
  },
  "location": {
    "street": "789 Hill St",
    "city": "San Francisco",
    "state": "CA",
    "zipCode": "94102"
  },
  "coverages": [
    {
      "coverageCode": "BODILY_INJURY",
      "limits": {
        "perPerson": 500000,
        "perAccident": 1000000
      },
      "isSelected": true
    },
    {
      "coverageCode": "PROPERTY_DAMAGE",
      "limits": {
        "perOccurrence": 500000
      },
      "isSelected": true
    },
    {
      "coverageCode": "COLLISION",
      "deductible": 250,
      "isSelected": true
    },
    {
      "coverageCode": "COMPREHENSIVE",
      "deductible": 250,
      "isSelected": true
    },
    {
      "coverageCode": "UNINSURED_MOTORIST",
      "limits": {
        "perPerson": 250000,
        "perAccident": 500000
      },
      "isSelected": true
    },
    {
      "coverageCode": "RENTAL_REIMBURSEMENT",
      "isSelected": true
    },
    {
      "coverageCode": "ROADSIDE_ASSISTANCE",
      "isSelected": true
    }
  ],
  "effectiveDate": "2025-11-01"
}

###############################################################################
# NOTES
###############################################################################

# VIN Examples:
# - 1HGBH41JXMN109186 = Honda Accord 2020
# - 4T1BF1FK5HU123456 = Toyota Camry 2020
# - WBS8M9C55NCE12345 = BMW M3 2022
# - 1FTFW1ET5BFC12345 = Ford F-150 2021
# - 5YJSA1E14HF123456 = Tesla Model S 2017

# Coverage Codes:
# - BODILY_INJURY
# - PROPERTY_DAMAGE
# - COLLISION
# - COMPREHENSIVE
# - UNINSURED_MOTORIST
# - PERSONAL_INJURY_PROTECTION
# - MEDICAL_PAYMENTS
# - RENTAL_REIMBURSEMENT
# - ROADSIDE_ASSISTANCE

# State Codes: CA, TX, FL, NY, IL, PA, OH, etc.

# Expected Premium Ranges:
# - Minimum coverage, good driver: $800-$1,200
# - Standard coverage, average driver: $1,200-$2,000
# - Full coverage, young driver: $2,500-$4,000+
